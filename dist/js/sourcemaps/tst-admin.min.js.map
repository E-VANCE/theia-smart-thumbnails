{"version":3,"sources":["tst-admin.min.js"],"names":["tst","togglePreview","button","preview","jQuery","val","show","hide","createPickerDelayed","options","input","size","createPickerDelayedHelper","setTimeout","createPicker","me","this","$","extend","image","sizes","position","x","y","init","mouseIsDown","isLoading","imageContainer","children","imageOverlay","crosshair","append","imageObject","document","createElement","onload","i","maxSize","width","parseInt","height","attr","css","caption","div","refreshPreview","previewButtonStatus","click","scrollTop","closest","src","mousemove","e","mousedown","mouseup","addClass","change","ajaxComplete","removeClass","preventDefault","offset","pageX","left","pageY","top","setPosition","Math","max","min","length","w","h","cssW","cssH","resize","imageResizeDimensions","orig_w","orig_h","dest_w","dest_h","interestX","interestY","aspect_ratio","new_w","new_h","floor","size_ratio","crop_w","round","crop_h","s_x","s_y"],"mappings":"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","file":"../tst-admin.min.js","sourcesContent":["/*\n * Copyright 2012-2018, Theia Smart Thumbnails, WeCodePixels, https://wecodepixels.com\n */\nvar tst = tst || {};\n\ntst.togglePreview = function (button) {\n    var preview = jQuery('.theiaSmartThumbnails_mediaUpload ._preview');\n    button = jQuery(button);\n\n    if (button.val() == 'Show Preview') {\n        button.val('Hide Preview');\n        preview.show();\n    } else {\n        button.val('Show Preview');\n        preview.hide();\n    }\n};\n\n// Create picker only after DOM elements have been added.\ntst.createPickerDelayed = function (options) {\n    if (jQuery(options.input).size() > 0) {\n        tst.createPickerDelayedHelper(options);\n    } else {\n        setTimeout(function (options) {\n            return function () {\n                tst.createPickerDelayed(options);\n            };\n        }(options), 50);\n    }\n};\n\ntst.createPickerDelayedHelper = function (options) {\n    jQuery(\".compat-field-theiaSmartThumbnails_position\").hide();\n    tst.createPicker(options);\n};\n\ntst.createPicker = function (options) {\n    var me = this,\n        $ = jQuery,\n        defaults = {\n            image: '',\n            input: '',\n            preview: '',\n            sizes: [],\n            position: {\n                x: 0.5,\n                y: 0.5\n            }\n        };\n    me.options = $.extend(defaults, options);\n\n    // Initialization function\n    me.init = function () {\n        me.mouseIsDown = false;\n        me.isLoading = false;\n        me.position = me.options.position;\n        me.input = $(me.options.input);\n        me.imageContainer = $(me.options.image);\n        me.image = me.imageContainer.children('img');\n        me.imageOverlay = $('<div class=\"_overlay\">');\n        me.crosshair = $('<div class=\"_crosshair tst-icon-target2\">');\n        me.preview = $(me.options.preview);\n        me.imageContainer.append(me.crosshair, me.imageOverlay);\n\n        // Load image.\n        me.imageObject = document.createElement('img');\n        me.imageObject.onload = (function (me) {\n            return function () {\n                var i, size;\n\n                // Keep an upper size limit for the thumbnails.\n                var maxSize = me.imageContainer.width() - 4;\n                for (i in me.options.sizes) {\n                    size = me.options.sizes[i];\n\n                    size.width = parseInt(size.width);\n                    size.height = parseInt(size.height);\n\n                    if (size.width > size.height) {\n                        if (size.width > maxSize) {\n                            size.height = size.height / size.width * maxSize;\n                            size.width = maxSize;\n                        }\n                    } else {\n                        if (size.height > maxSize) {\n                            size.width = size.width / size.height * maxSize;\n                            size.height = maxSize;\n                        }\n                    }\n\n                    me.options.sizes[i] = size;\n                }\n\n                // Create preview elements for each size\n                for (i in me.options.sizes) {\n                    size = me.options.sizes[i];\n                    size.image = $('<img src=\"' + me.image.attr('src') + '\">');\n                    size.imageContainer = $('<div class=\"_imageContainer\">')\n                        .css({\n                            width: size.width,\n                            height: size.height\n                        })\n                        .append(size.image);\n                    size.caption = $('<div class=\"_caption\">' + i + '</div>');\n                    size.div = $('<div>')\n                        .append(size.imageContainer, size.caption);\n                    me.preview.append(size.div);\n                }\n\n                // Refresh previews.\n                me.refreshPreview();\n\n                // Set preview button status.\n                if (tst.previewButtonStatus) {\n                    jQuery('.theiaSmartThumbnails_mediaUpload ._previewButton')\n                        .val(tst.previewButtonStatus)\n                        .click()\n                        .click();\n                }\n\n                // Set container scrollTop.\n                if (tst.scrollTop) {\n                    me.input.closest('.attachment-info').scrollTop(tst.scrollTop);\n                    tst.scrollTop = null;\n                }\n            };\n        })(me);\n        me.imageObject.src = me.image.attr('src');\n\n        // Mouse events\n        $(document)\n            .mousemove(function (e) {\n                if (me.mouseIsDown) {\n                    me.mousedown(e);\n                }\n            })\n            .mouseup(function () {\n                if (me.mouseIsDown) {\n                    me.mouseIsDown = false;\n\n                    // Inside a modal window in WordPress 3.5?\n                    if (\n                        jQuery(\".version-3-4\").size() === 0 &&\n                        me.input.closest(\".media-modal\").size() === 1\n                    ) {\n                        // Is it readonly (e.g. contributor role)?\n                        if (jQuery('label.setting[data-setting=\"title\"] input').attr('readonly') == 'readonly') {\n                            return;\n                        }\n\n                        me.isLoading = true;\n\n                        // Remember scroll position and preview button status.\n                        tst.scrollTop = me.input.closest('.attachment-info').scrollTop();\n                        tst.previewButtonStatus = jQuery('.theiaSmartThumbnails_mediaUpload ._previewButton').val();\n\n                        // Display loader.\n                        me.imageOverlay.addClass('_loader');\n\n                        // Fire change event, which will fire an AJAX request.\n                        me.input.change();\n                    }\n                }\n            });\n        me.imageOverlay\n            .mousedown(function (e) {\n                if (!me.isLoading) {\n                    me.mouseIsDown = true;\n                    me.mousedown(e);\n                }\n            })\n            .mousemove(function (e) {\n                if (me.mouseIsDown) {\n                    me.mousedown(e);\n                }\n            });\n\n        // When using the Advanced Custom Fields plugin, we need to hide the loader manually.\n        $(document).ajaxComplete(function (me) {\n            return function () {\n                me.isLoading = false;\n                me.imageOverlay.removeClass('_loader');\n            };\n        }(me));\n    };\n\n    me.mousedown = function (e) {\n        e.preventDefault();\n        var offset = me.image.offset(),\n            x = e.pageX - offset.left,\n            y = e.pageY - offset.top;\n        me.setPosition(x, y);\n    };\n\n    // Set x and y position.\n    me.setPosition = function (x, y) {\n        me.position.x = Math.max(0, Math.min(1, x / me.image.width()));\n        me.position.y = Math.max(0, Math.min(1, y / me.image.height()));\n        if (me.input.length == 1) {\n            me.input.val('[' + me.position.x + ',' + me.position.y + ']');\n        }\n        else if (me.input.length == 2) {\n            $(me.input[0]).val(me.position.x);\n            $(me.input[1]).val(me.position.y);\n        }\n        me.refreshPreview();\n    };\n\n    // Refresh all the previews.\n    me.refreshPreview = function () {\n        me.crosshair.css({\n            left: me.position.x * me.image.width(),\n            top: me.position.y * me.image.height()\n        });\n        for (var i in me.options.sizes) {\n            var size = me.options.sizes[i];\n            var resize = tst.imageResizeDimensions(me.imageObject.width, me.imageObject.height, size.width, size.height, me.position.x, me.position.y);\n            var w, h, cssW, cssH;\n            if (me.imageObject.width - resize[6]) {\n                w = me.imageObject.width / me.imageObject.height * resize[5];\n                h = resize[5];\n                cssW = 'auto';\n                cssH = resize[5];\n            } else {\n                w = resize[4];\n                h = me.imageObject.height / me.imageObject.width * resize[4];\n                cssW = resize[4];\n                cssH = 'auto';\n            }\n            size.image.css({\n                left: -resize[2] / me.imageObject.width * w,\n                top: -resize[3] / me.imageObject.height * h,\n                width: cssW,\n                height: cssH\n            });\n        }\n    };\n\n    // Initialize.\n    me.init();\n};\n\n// Calculates the resize box. Similar to WordPress's image_resize_dimensions.\ntst.imageResizeDimensions = function (orig_w, orig_h, dest_w, dest_h, interestX, interestY) {\n    var aspect_ratio = orig_w / orig_h;\n    var new_w = Math.min(dest_w, orig_w);\n    var new_h = Math.min(dest_h, orig_h);\n\n    if (!new_w) {\n        new_w = Math.floor(new_h * aspect_ratio);\n    }\n\n    if (!new_h) {\n        new_h = Math.floor(new_w / aspect_ratio);\n    }\n\n    var size_ratio = Math.max(new_w / orig_w, new_h / orig_h);\n\n    var crop_w = Math.round(new_w / size_ratio);\n    var crop_h = Math.round(new_h / size_ratio);\n\n    var s_x = Math.floor((orig_w - crop_w) * interestX);\n    var s_y = Math.floor((orig_h - crop_h) * interestY);\n\n    return [0, 0, Math.round(s_x), Math.round(s_y), Math.round(new_w), Math.round(new_h), Math.round(crop_w), Math.round(crop_h)];\n};\n"]}